executor: KubernetesExecutor

airflow:
  image:
    repository: apache/airflow
    tag: 2.8.4
    pullPolicy: IfNotPresent

# Use chart-managed Postgres for Airflow metadata DB (RECOMMENDED for minikube/dev)
postgresql:
  enabled: true
  image:
    registry: docker.io
    repository: bitnami/postgresql
    tag: latest
  auth:
    username: airflow
    password: airflow123
    database: airflow

# Not needed for KubernetesExecutor
redis:
  enabled: false

webserver:
  service:
    type: NodePort

# Persist logs? (optional)
logs:
  persistence:
    enabled: false

# --------------------------
# Shared PVC for pipeline data
# --------------------------

# Mount PVC into Airflow core components
scheduler:
  extraVolumes:
    - name: pipeline-data
      persistentVolumeClaim:
        claimName: pipeline-data
  extraVolumeMounts:
    - name: pipeline-data
      mountPath: /data

webserver:
  extraVolumes:
    - name: pipeline-data
      persistentVolumeClaim:
        claimName: pipeline-data
  extraVolumeMounts:
    - name: pipeline-data
      mountPath: /data

triggerer:
  extraVolumes:
    - name: pipeline-data
      persistentVolumeClaim:
        claimName: pipeline-data
  extraVolumeMounts:
    - name: pipeline-data
      mountPath: /data

dagProcessor:
  extraVolumes:
    - name: pipeline-data
      persistentVolumeClaim:
        claimName: pipeline-data
  extraVolumeMounts:
    - name: pipeline-data
      mountPath: /data

# IMPORTANT: This makes KubernetesExecutor TASK PODS mount the PVC too
kubernetes:
  volumes:
    - name: pipeline-data
      persistentVolumeClaim:
        claimName: pipeline-data
  volumeMounts:
    - name: pipeline-data
      mountPath: /data
